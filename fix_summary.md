# PyDrone å››è½´é£æ§ç³»ç»Ÿä¿®å¤æ€»ç»“

## ğŸ”§ å·²ä¿®å¤çš„é—®é¢˜

### 1. å‡½æ•°å‚æ•°ç´¢å¼•é”™è¯¯ (mod_drone.c:135)
**é—®é¢˜**: `drone_trim()` å‡½æ•°ä¸­ `pit` å˜é‡ä½¿ç”¨äº†é”™è¯¯çš„å‚æ•°ç´¢å¼•
```c
// ä¿®å¤å‰:
float pit = ((float)args[0].u_int)/100.0f;  // é”™è¯¯ï¼Œåº”è¯¥ä½¿ç”¨args[1]

// ä¿®å¤å:  
float pit = ((float)args[1].u_int)/100.0f;  // æ­£ç¡®ä½¿ç”¨ç¬¬äºŒä¸ªå‚æ•°
```

### 2. ç¼ºå¤±å‡½æ•°å®šä¹‰ (mod_drone.c:341-344)
**é—®é¢˜**: `drone_is_hover_active_obj` è¢«å¼•ç”¨ä½†å‡½æ•°æœªå®šä¹‰
```c
// æ–°å¢å‡½æ•°:
STATIC mp_obj_t drone_is_hover_active(mp_obj_t self_in)
{
	return mp_obj_new_bool(hoverControlIsActive());
}
STATIC MP_DEFINE_CONST_FUN_OBJ_1(drone_is_hover_active_obj, drone_is_hover_active);
```

### 3. å‡½æ•°æœªå¯¼å‡ºåˆ°æ¨¡å— (mod_drone.c:419-421)
**é—®é¢˜**: `read_motor_power` å’Œ `is_hover_active` å‡½æ•°æœªæ·»åŠ åˆ°æ¨¡å—å­—å…¸
```c
// æ–°å¢å¯¼å‡º:
{ MP_ROM_QSTR(MP_QSTR_read_motor_power), MP_ROM_PTR(&read_motor_power_obj) },
{ MP_ROM_QSTR(MP_QSTR_is_hover_active), MP_ROM_PTR(&drone_is_hover_active_obj) },
```

### 4. å¤´æ–‡ä»¶ä¾èµ– (mod_drone.c:45-46)
**é—®é¢˜**: ç¼ºå°‘ `hover_control.h` å¤´æ–‡ä»¶å¼•å…¥
```c
// æ–°å¢å¼•å…¥:
#include "hover_control.h"
```

## âœ… éªŒè¯å®Œæˆçš„åŠŸèƒ½

### APIæ¥å£å®Œæ•´æ€§
- âœ… `drone.read_states()` - è¿”å›18ä¸ªå®Œæ•´çŠ¶æ€æ•°æ®
- âœ… `drone.read_motor_power()` - è¿”å›4ä¸ªç”µæœºåŠŸç‡æ•°æ®  
- âœ… `drone.is_hover_active()` - æ£€æŸ¥æ‚¬åœæ§åˆ¶çŠ¶æ€
- âœ… `drone.take_off()` - ä¸€é”®èµ·é£
- âœ… `drone.landing()` - ä¸€é”®é™è½
- âœ… `drone.control()` - é£è¡Œæ§åˆ¶
- âœ… `drone.trim()` - å‚æ•°è°ƒèŠ‚(å·²ä¿®å¤)

### ç±»å‹å®šä¹‰éªŒè¯
- âœ… `flowMeasurement_t` - å…‰æµæµ‹é‡ç±»å‹ (stabilizer_types.h:258)
- âœ… `tofMeasurement_t` - TOFæµ‹é‡ç±»å‹ (stabilizer_types.h:266)  
- âœ… `motorPower_t` - ç”µæœºåŠŸç‡ç±»å‹ (power_distribution.h:31)
- âœ… `attitude_t` - å§¿æ€æ•°æ®ç±»å‹ (stabilizer_types.h:36)

### å‡½æ•°å£°æ˜éªŒè¯
- âœ… `getMotorPWM()` - power_distribution.h:43
- âœ… `getFusedHeight()` - state_estimator.h:15
- âœ… `getSetHeight()` - stabilizer.h:66
- âœ… `getCachedFlowData()` - stabilizer.h:62
- âœ… `getCachedTofData()` - stabilizer.h:63
- âœ… `hoverControlIsActive()` - hover_control.h:45

## ğŸš ç³»ç»ŸåŠŸèƒ½æ¦‚è§ˆ

### æ ¸å¿ƒé£æ§ç³»ç»Ÿ
1. **å§¿æ€æ§åˆ¶**: Roll/Pitch/Yawä¸‰è½´ç¨³å®šæ§åˆ¶
2. **é«˜åº¦æ§åˆ¶**: æ°”å‹è®¡+TOFä¼ æ„Ÿå™¨èåˆå®šé«˜
3. **ç”µæœºæ§åˆ¶**: å››ç”µæœºPWMæ··æ§è¾“å‡º (M1/M2/M3/M4)
4. **PIDæ§åˆ¶**: å¤šçº§ä¸²çº§PIDæ§åˆ¶æ¶æ„

### ä¼ æ„Ÿå™¨èåˆ
1. **IMUä¼ æ„Ÿå™¨**: MPU6050 (åŠ é€Ÿåº¦è®¡+é™€èºä»ª)
2. **ç£åŠ›è®¡**: HMC5883L ç½—ç›˜å¯¼èˆª
3. **æ°”å‹è®¡**: SPL06 æ°”å‹é«˜åº¦æµ‹é‡
4. **TOFæ¿€å…‰**: VL53L1X ç²¾ç¡®è·ç¦»æµ‹é‡
5. **å…‰æµä¼ æ„Ÿå™¨**: PMW3901 ä½ç½®ä¿æŒ

### æ§åˆ¶æ¥å£
1. **WiFiæ§åˆ¶**: æ— çº¿é¥æ§æ¥å£
2. **è‡ªåŠ¨é£è¡Œ**: ä¸€é”®èµ·é£/é™è½/æ‚¬åœ
3. **å®‰å…¨æœºåˆ¶**: ç´§æ€¥åœæœºä¿æŠ¤
4. **é£è¡Œæ¨¡å¼**: æœ‰å¤´/æ— å¤´æ¨¡å¼åˆ‡æ¢

### æ•°æ®ç›‘æ§ (18ä¸ªå‚æ•°)
```python
states = drone.read_states()  # è¿”å›18ä¸ªå…ƒç´ çš„çŠ¶æ€æ•°ç»„

# å§¿æ€æ•°æ® (0-2)
attitude_roll = states[0] / 100.0    # Rollè§’åº¦ (åº¦)
attitude_pitch = states[1] / 100.0   # Pitchè§’åº¦ (åº¦)  
attitude_yaw = states[2] / 100.0     # Yawè§’åº¦ (åº¦)

# æ§åˆ¶è¾“å…¥ (3-5)
ctrl_roll = states[3] / 100.0        # Rollæ§åˆ¶è¾“å…¥
ctrl_pitch = states[4] / 100.0       # Pitchæ§åˆ¶è¾“å…¥
ctrl_yaw = states[5] / 100.0         # Yawæ§åˆ¶è¾“å…¥

# ç³»ç»ŸçŠ¶æ€ (6-8)
thrust_input = states[6]             # æ¨åŠ›è¾“å…¥ (0-100)
battery_voltage = states[7] / 100.0  # ç”µæ± ç”µå‹ (V)
height = states[8]                   # èåˆé«˜åº¦ (mm)

# ä¼ æ„Ÿå™¨æ•°æ® (9-12)
flow_x = states[9] / 100.0           # å…‰æµXæ–¹å‘å˜åŒ–
flow_y = states[10] / 100.0          # å…‰æµYæ–¹å‘å˜åŒ–
tof_distance = states[11]            # TOFè·ç¦» (mm)
sensor_status = states[12]           # ä¼ æ„Ÿå™¨çŠ¶æ€æ ‡å¿—

# ç”µæœºåŠŸç‡ (13-16) - æ–°å¢ç”¨äºæ•…éšœè¯Šæ–­
motor_m1_power = states[13]          # M1ç”µæœºåŠŸç‡ (0-65535)
motor_m2_power = states[14]          # M2ç”µæœºåŠŸç‡ (0-65535)
motor_m3_power = states[15]          # M3ç”µæœºåŠŸç‡ (0-65535)  
motor_m4_power = states[16]          # M4ç”µæœºåŠŸç‡ (0-65535)

# ç›®æ ‡é«˜åº¦ (17) - æ–°å¢ç”¨äºé«˜åº¦æ§åˆ¶è¯Šæ–­
target_height_mm = states[17]        # ç›®æ ‡è®¾å®šé«˜åº¦ (mm)
```

## ğŸ¯ æ•…éšœè¯Šæ–­èƒ½åŠ›

æ–°å¢çš„ç”µæœºåŠŸç‡å’Œç›®æ ‡é«˜åº¦æ•°æ®ç‰¹åˆ«é€‚ç”¨äºï¼š

1. **å®æ—¶ç›‘æ§å››ä¸ªç”µæœºçš„åŠŸç‡åˆ†é…**
2. **è¯Šæ–­ç‰¹å®šç”µæœºåœè½¬é—®é¢˜** (å¦‚M1ã€M3åœè½¬)
3. **éªŒè¯æ··æ§ç®—æ³•æ˜¯å¦æ­£ç¡®å·¥ä½œ**
4. **æ£€æŸ¥ç”µæœºåŠŸç‡æ˜¯å¦ä¸è¾“å…¥æ¨åŠ›åŒ¹é…**
5. **åˆ†æé«˜åº¦æ§åˆ¶å¼‚å¸¸** (ç›®æ ‡vså®é™…é«˜åº¦åå·®)

## ğŸ”¨ ç¼–è¯‘çŠ¶æ€

**æ‰€æœ‰ä»£ç é—®é¢˜å·²ä¿®å¤**ï¼Œå…·å¤‡ç¼–è¯‘æ¡ä»¶:
- âœ… è¯­æ³•é”™è¯¯å·²ä¿®å¤
- âœ… å‡½æ•°å£°æ˜å®Œæ•´
- âœ… ç±»å‹å®šä¹‰å­˜åœ¨
- âœ… å¤´æ–‡ä»¶ä¾èµ–æ­£ç¡®
- âš ï¸ éœ€è¦ESP-IDFç¯å¢ƒæ”¯æŒ

## ğŸ“‹ åç»­å»ºè®®

1. **é…ç½®ESP-IDFç¯å¢ƒ**: å®‰è£…ESP-IDF SDKè¿›è¡Œå®é™…ç¼–è¯‘æµ‹è¯•
2. **ç¡¬ä»¶åœ¨ç¯æµ‹è¯•**: éªŒè¯ç”µæœºåŠŸç‡ç›‘æ§åŠŸèƒ½
3. **é£è¡Œæµ‹è¯•**: éªŒè¯ä¿®å¤åçš„trimåŠŸèƒ½å’Œæ‚¬åœæ§åˆ¶
4. **æ€§èƒ½ä¼˜åŒ–**: ç›‘æ§read_states()è°ƒç”¨é¢‘ç‡å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“